version: '3.8'

services:
  broker:
    container_name: broker-app
    image: dleclercpro/eda-playground-broker:v1.2.0
    build:
      context: ./Apps
      dockerfile: Broker.Dockerfile
    ports:
      - 4000:4000
    networks:
      - app
    environment:
      NODE_ENV: production
    stop_grace_period: 1s

  order:
    container_name: order-app
    image: dleclercpro/eda-playground-order:v1.2.0
    build:
      context: ./Apps
      dockerfile: Order.Dockerfile
    networks:
      - app
    depends_on:
      - broker
    environment:
      NODE_ENV: production
    stop_grace_period: 1s

  payment:
    container_name: payment-app
    image: dleclercpro/eda-playground-payment:v1.2.0
    build:
      context: ./Apps
      dockerfile: Payment.Dockerfile
    networks:
      - app
    depends_on:
      - broker
    environment:
      NODE_ENV: production
    stop_grace_period: 1s

  delivery:
    container_name: delivery-app
    image: dleclercpro/eda-playground-delivery:v1.2.0
    build:
      context: ./Apps
      dockerfile: Delivery.Dockerfile
    networks:
      - app
    depends_on:
      - broker
    environment:
      NODE_ENV: production
    stop_grace_period: 1s

networks:
  app:
    driver: bridge